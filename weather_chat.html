<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #0b62ad, #bb1212);
        color: white;
        font-family: "Roboto", sans-serif;
        padding: 20px;
      }

      .container {
        max-width: 400px;
        width: 100%;
      }

      .container h1 {
        margin-bottom: 20px;
        font-weight: 600;
        text-shadow: 4px 4px 15px rgba(11, 11, 11, 0.3);
        background: linear-gradient(to right, #00ffff, #0aa26f);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-align: center;
      }

      .search-container {
        display: flex;
        border-radius: 20px;
        overflow: hidden;
        background-color: aliceblue;
        margin-bottom: 20px;
      }

      #cityInput {
        flex: 1;
        padding: 12px 20px;
        border: none;
        background-color: #d7d3d3;
        font-size: 18px;
        outline: none;
      }

      #searchBtn {
        padding: 12px 24px;
        background-color: #29b729;
        border: none;
        color: white;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      #searchBtn:hover {
        background-color: #228b22;
      }

      .weather-info {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        min-height: 300px;
        background-size: cover;
        background-position: center;
        position: relative;
      }

      .weather-info::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        z-index: 1;
      }

      .weather-info > * {
        position: relative;
        z-index: 2;
      }

      .weather-info h2 {
        margin-bottom: 15px;
        font-size: 24px;
      }

      .weather-info h1 {
        font-size: 48px;
        margin: 10px 0;
      }

      .weather-info h3 {
        margin: 15px 0;
        font-size: 20px;
        text-transform: capitalize;
      }

      .weather-info img {
        width: 100px;
        height: 100px;
      }

      .error-message {
        color: #ff6b6b;
        text-align: center;
        margin-top: 20px;
        font-size: 18px;
        white-space: pre-wrap;
      }

      .loading {
        text-align: center;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Weather Dashboard</h1>
      <div class="search-container">
        <input
          type="text"
          id="cityInput"
          placeholder="Enter city name"
          aria-label="City name"
        />
        <button id="searchBtn">Search</button>
      </div>
      <div class="weather-info"></div>
    </div>

    <script>
      class WeatherApp {
        constructor() {
          this.apiKey = "c5e0061f203ec2c1b5f6535319d61355";
          this.unsplashKey = "R-LYXoSbGN89WceMkIggiDiXelm1Z_rI7p7sBrHRRqE";
          this.weatherInfo = document.querySelector(".weather-info");
          this.init();
        }

        init() {
          this.setupEventListeners();
        }

        setupEventListeners() {
          document
            .getElementById("searchBtn")
            .addEventListener("click", () => this.handleSearch());
          document
            .getElementById("cityInput")
            .addEventListener("keypress", (e) => {
              if (e.key === "Enter") this.handleSearch();
            });
        }

        async handleSearch() {
          const city = document.getElementById("cityInput").value.trim();
          if (!city) {
            this.showError("Please enter a city name");
            return;
          }

          this.showLoading();

          try {
            const weatherData = await this.fetchWeatherData(city);
            const backgroundImage = await this.fetchBackgroundImage(
              weatherData.description
            );
            this.displayWeather(weatherData, backgroundImage);
          } catch (error) {
            console.error("Error details:", error);
            this.showError(
              `Unable to fetch weather data. Please try again.\nError: ${error.message}`
            );
          }
        }

        async fetchWeatherData(city) {
          const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(
            city
          )}&appid=${this.apiKey}&units=metric`;

          const response = await fetch(url);
          const data = await response.json();

          if (data.cod !== 200) {
            throw new Error(data.message || "Failed to fetch weather data");
          }

          return {
            city: data.name,
            country: data.sys.country,
            temp: Math.round(data.main.temp),
            description: data.weather[0].description,
            icon: data.weather[0].icon,
            humidity: data.main.humidity,
            windSpeed: data.wind.speed,
          };
        }

        async fetchBackgroundImage(description) {
          const url = `https://api.unsplash.com/photos/random?query=${encodeURIComponent(
            description + " weather"
          )}&client_id=${this.unsplashKey}`;
          try {
            const response = await fetch(url);
            const data = await response.json();
            console.log("Unsplash response:", data);
            return data.urls.regular;
          } catch (error) {
            console.error("Unsplash error:", error);
            return null;
          }
        }

        displayWeather(weatherData, backgroundImage) {
          const iconUrl = `https://openweathermap.org/img/wn/${weatherData.icon}@2x.png`;

          if (backgroundImage) {
            this.weatherInfo.style.backgroundImage = `url(${backgroundImage})`;
          }

          this.weatherInfo.innerHTML = `
                    <h2>${weatherData.city}, ${weatherData.country}</h2>
                    <h1>${weatherData.temp}Â°C</h1>
                    <img src="${iconUrl}" alt="Weather Icon">
                    <h3>${weatherData.description}</h3>
                    <p>Humidity: ${weatherData.humidity}%</p>
                    <p>Wind Speed: ${weatherData.windSpeed} m/s</p>
                `;
        }

        showError(message) {
          this.weatherInfo.innerHTML = `<div class="error-message">${message}</div>`;
          this.weatherInfo.style.backgroundImage = "none";
        }

        showLoading() {
          this.weatherInfo.innerHTML =
            '<div class="loading">Loading weather data...</div>';
          this.weatherInfo.style.backgroundImage = "none";
        }
      }

      // Initialize the app
      const app = new WeatherApp();
    </script>
  </body>
</html>
